<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLink Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #map { height: 300px; width: 100%; max-width: 600px; border-radius: 12px; margin: 20px 0; }
        button { width: 100%; max-width: 600px; padding: 15px; margin: 5px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-locate { background: #00ff88; color: #000; }
        .btn-whatsapp { background: #25D366; color: white; display: none; }
        .btn-google { background: #4285F4; color: white; display: none; }
    </style>
</head>
<body>

    <h1>üìç GeoLink Tracker</h1>
    <p id="status">Waiting for user action...</p>

    <div id="map"></div>

    <button class="btn-locate" id="locateBtn" onclick="getLocation()">FIND MY LOCATION</button>
    <button class="btn-whatsapp" id="waBtn" onclick="sendToWhatsApp()">SEND TO WHATSAPP</button>
    <button class="btn-google" id="gmBtn" onclick="openGoogleMaps()">OPEN MAPS</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

        let currentLat, currentLong, mapLink;

        function getLocation() {
            const status = document.getElementById('status');
            
            if (!navigator.geolocation) {
                status.innerText = "Error: Browser doesn't support GPS.";
                return;
            }

            status.innerText = "Locating... (Allow permission)";

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // Success
                    currentLat = position.coords.latitude;
                    currentLong = position.coords.longitude;
                    
                    // FIXED: Corrected the link formatting here
                    mapLink = `https://www.google.com/maps?q=${currentLat},${currentLong}`;

                    status.innerText = `Lat: ${currentLat.toFixed(5)} | Long: ${currentLong.toFixed(5)}`;
                    
                    // Update Map
                    map.setView([currentLat, currentLong], 16);
                    L.marker([currentLat, currentLong]).addTo(map);

                    // Show Buttons
                    document.getElementById('waBtn').style.display = 'block';
                    document.getElementById('gmBtn').style.display = 'block';
                    document.getElementById('locateBtn').style.display = 'none';
                },
                (error) => {
                    // Error Handling
                    let msg = "Error.";
                    if(error.code === 1) msg = "PERMISSION DENIED: You must click 'Allow'.";
                    if(error.code === 2) msg = "POSITION UNAVAILABLE: GPS signal weak.";
                    if(error.code === 3) msg = "TIMEOUT: Took too long.";
                    
                    // Check if running from file://
                    if (window.location.protocol === 'file:') {
                        msg += " (Do not open file directly. Host it on GitHub!)";
                    }
                    
                    status.innerText = msg;
                    alert(msg);
                },
                { enableHighAccuracy: true }
            );
        }

        function sendToWhatsApp() {
            const msg = `My Location: ${mapLink}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function openGoogleMaps() {
            window.open(mapLink, '_blank');
        }
    </script>
</body>
</html>
